<!DOCTYPE html>
<html>

      <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>The Selection Gradients Project: Adaptive Geometry of Antagonism and Cooperation</title>
        <meta name="viewport" content="width=device-width">
        <meta name="description" content="Lee Worden prototype research website" />
        <link rel="canonical" href="/Selection_Gradients//" />

        <!-- Custom CSS -->
	<link rel="stylesheet" href="/adaptive-dynamics-research/css/main.css">
	<link rel="stylesheet" href="/adaptive-dynamics-research/css/auto-generated-from-ww.css">
	<link rel="stylesheet" href="/adaptive-dynamics-research/css/wmd.css">
        <script type="text/x-mathjax-config">MathJax.Hub.Config({ jax: ["input/MathML", "output/HTML-CSS"] });</script>
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=MML_HTMLorMML"></script>

    </head>


    <body>

    <header class="site-header">

  <div class="wrap">

    <a class="site-title" href="/adaptive-dynamics-research/">Lee Worden research prototype website</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        <a class="page-link" href="/adaptive-dynamics-research/about">About</a>
	<a class="page-link" href="/adaptive-dynamics-research/projects">Projects</a>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>The Selection Gradients Project: Adaptive Geometry of Antagonism and Cooperation</h1>
  </header>

  <article class="post-content">
  <p>I’m working on a paper about selection gradients and interactions - I’m not ready to upload it here, but I think I’ll do the simulation here.</p>

<p>I’m using Sage to evaluate and analyze these models.</p>

<ul>
  <li><a href="MacLev.html">Adaptive Geometry of Resource Competition</a>: introducing the MacArthur-Levins resource competition model, and Sage code for it
    <ul>
      <li><a href="MacLev-1-1.html">Adaptive Geometry of Resource Competition: One Species, One Resource</a>: analysis of the simple case</li>
      <li><a href="MacLev-2-2.html">Adaptive Geometry of Resource Competition: Two Species, Two Resources</a>: not so simple</li>
      <li><a href="notes.html">Notes</a></li>
    </ul>
  </li>
</ul>

<p>This project also uses Sage code that’s stored in an external Git repository:</p>

<ul>
  <li><a href="https://github.com/worden-lee/SageDynamics.git">SageDynamics</a></li>
</ul>

<h2 id="general-results-about-selection-gradients">General results about selection gradients</h2>

<p>For some reason a bunch of this is on <a href="MacLev.html">Adaptive Geometry of Resource Competition</a>, including review of adaptive dynamics, adaptive dynamics of constrained phenotypes, and the adaptive dynamics of <!-- 0cc175b9c0f1b6a831c399e269772661.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="a" display="inline"><mi>a</mi></math></span> and <!-- 8ce4b16b22b58894aa86c421e8759df3.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="k" display="inline"><mi>k</mi></math></span>, including the direct and indirect effects.</p>

<p>Here is the part about motion of the <!-- 1f7d3da922442bec0425d6e3e395d701.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="(a_{ij},a_{ji})" display="inline"><mrow><mo stretchy="false">(</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>⁢</mo><mi>j</mi></mrow></msub><mo>,</mo><msub><mi>a</mi><mrow><mi>j</mi><mo>⁢</mo><mi>i</mi></mrow></msub><mo stretchy="false">)</mo></mrow></math></span> pair.</p>

<p>When there are more than one or two species interacting, the only good way to
visualize the motion of <!-- 0cc175b9c0f1b6a831c399e269772661.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="a" display="inline"><mi>a</mi></math></span> and <!-- 8ce4b16b22b58894aa86c421e8759df3.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="k" display="inline"><mi>k</mi></math></span> terms is pairwise, so we’ll be looking
at <!-- 1f7d3da922442bec0425d6e3e395d701.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="(a_{ij},a_{ji})" display="inline"><mrow><mo stretchy="false">(</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>⁢</mo><mi>j</mi></mrow></msub><mo>,</mo><msub><mi>a</mi><mrow><mi>j</mi><mo>⁢</mo><mi>i</mi></mrow></msub><mo stretchy="false">)</mo></mrow></math></span> pairs moving on the classic plane of four quadrants.
This is also how I’ve been presenting the result, as motion from the other
three quadrants toward the mutualistic quarter.  Here then is the motion
of those pairs.</p>

<p>Using the expressions for motion of the matrix row <!-- 6c6404adc033dfed51422fdaf7fa0494.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="\mathbf{A}" display="inline"><mi>𝐀</mi></math></span>, we
introduce a little new notation: let</p>

<p><!-- a9d33eea935b2e4607a95bab1426239c.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="D_{ik}=\gamma\hat{X}_{i}\partial_{1}a(\mathbf{u}_{i},\mathbf{u}_{k})\partial_{%&#10;1}\mathbf{A}_{i}(\mathbf{u}_{i})^{T}S(\mathbf{A}_{i})" display="inline"><mrow><msub><mi>D</mi><mrow><mi>i</mi><mo>⁢</mo><mi>k</mi></mrow></msub><mo>=</mo><mrow><mi>γ</mi><mo>⁢</mo><msub><mover accent="true"><mi>X</mi><mo stretchy="false">^</mo></mover><mi>i</mi></msub><mo>⁢</mo><mrow><msub><mo>∂</mo><mn>1</mn></msub><mo>⁡</mo><mi>a</mi></mrow><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>𝐮</mi><mi>i</mi></msub><mo>,</mo><msub><mi>𝐮</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><mo>⁢</mo><mrow><msub><mo>∂</mo><mn>1</mn></msub><mo>⁡</mo><msub><mi>𝐀</mi><mi>i</mi></msub></mrow><mo>⁢</mo><msup><mrow><mo stretchy="false">(</mo><msub><mi>𝐮</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><mi>T</mi></msup><mo>⁢</mo><mi>S</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>𝐀</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></math></span></p>

<p>be the <!-- 8ce4b16b22b58894aa86c421e8759df3.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="k" display="inline"><mi>k</mi></math></span>th entry of <!-- aa7989b04c2d41a4343cd90818de18b4.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="D(\mathbf{u}_{i})" display="inline"><mrow><mi>D</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>𝐮</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></mrow></math></span>, i.e. the direct effect of
change in <!-- 702c7ec36a2e8896018332ba9b37e8cb.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="\mathbf{u}_{i}" display="inline"><msub><mi>𝐮</mi><mi>i</mi></msub></math></span> on <!-- 16868711d2f80fc5c4b56ed9721a2224.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="a_{ik}" display="inline"><msub><mi>a</mi><mrow><mi>i</mi><mo>⁢</mo><mi>k</mi></mrow></msub></math></span>; and let</p>

<p><!-- ce733924c162b437faa1161a75585cae.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="I_{ik}=\gamma\hat{X}_{k}\partial_{2}a(\mathbf{u}_{i},\mathbf{u}_{k})\partial_{%&#10;1}\mathbf{A}_{k}(\mathbf{u}_{k})^{T}S(\mathbf{A}_{k})" display="inline"><mrow><msub><mi>I</mi><mrow><mi>i</mi><mo>⁢</mo><mi>k</mi></mrow></msub><mo>=</mo><mrow><mi>γ</mi><mo>⁢</mo><msub><mover accent="true"><mi>X</mi><mo stretchy="false">^</mo></mover><mi>k</mi></msub><mo>⁢</mo><mrow><msub><mo>∂</mo><mn>2</mn></msub><mo>⁡</mo><mi>a</mi></mrow><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>𝐮</mi><mi>i</mi></msub><mo>,</mo><msub><mi>𝐮</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><mo>⁢</mo><mrow><msub><mo>∂</mo><mn>1</mn></msub><mo>⁡</mo><msub><mi>𝐀</mi><mi>k</mi></msub></mrow><mo>⁢</mo><msup><mrow><mo stretchy="false">(</mo><msub><mi>𝐮</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><mi>T</mi></msup><mo>⁢</mo><mi>S</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>𝐀</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></math></span></p>

<p>be the <!-- 8ce4b16b22b58894aa86c421e8759df3.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="k" display="inline"><mi>k</mi></math></span>th entry of <!-- 1450bd6f70a63c99942a69c0d82b483c.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="I(\mathbf{u}_{i})" display="inline"><mrow><mi>I</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>𝐮</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></mrow></math></span>, the indirect effect of change in
<!-- 573d3b8721b7f7d6ec7bfa297098aac7.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="\mathbf{u}_{k}" display="inline"><msub><mi>𝐮</mi><mi>k</mi></msub></math></span> on <!-- 16868711d2f80fc5c4b56ed9721a2224.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="a_{ik}" display="inline"><msub><mi>a</mi><mrow><mi>i</mi><mo>⁢</mo><mi>k</mi></mrow></msub></math></span>.</p>

<p>NOTE the <!-- f623e75af30e62bbd73d6df5b50bb7b5.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="D" display="inline"><mi>D</mi></math></span> and <!-- dd7536794b63bf90eccfd37f9b147d7f.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="I" display="inline"><mi>I</mi></math></span> notation in the other section is not acceptable:
<!-- 109fd5c780a1eb6cdf7a073a637a23b2.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="\partial_{2}\mathbf{A}_{i}(\mathbf{u}_{k})" display="inline"><mrow><mrow><msub><mo>∂</mo><mn>2</mn></msub><mo>⁡</mo><msub><mi>𝐀</mi><mi>i</mi></msub></mrow><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>𝐮</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></math></span>
is incoherent. Fix throughout.  Possibly using notation like
<!-- f8919a3b354da3728ba95a2851ec4aa8.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="\partial_{2}a(\mathbf{u}_{i},\mathbf{u}_{k})" display="inline"><mrow><mrow><msub><mo>∂</mo><mn>2</mn></msub><mo>⁡</mo><mi>a</mi></mrow><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>𝐮</mi><mi>i</mi></msub><mo>,</mo><msub><mi>𝐮</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></math></span>.</p>

<p>Anyway, the change in <!-- 9a59294d35ec9247478796ffb89359eb.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="a_{ij}" display="inline"><msub><mi>a</mi><mrow><mi>i</mi><mo>⁢</mo><mi>j</mi></mrow></msub></math></span> is</p>

<p><fieldset class="ww-messages"><legend>&lt;ww-messages-legend: &gt;</legend><p class='error'>Error: Project file not found: Standalone?fb040d3cf71c60e7eeffaf658729cacc.tex-inline › fb040d3cf71c60e7eeffaf658729cacc.tex-inline.latexml.html</p>
</fieldset>
<!-- fb040d3cf71c60e7eeffaf658729cacc.tex-inline.latexml.html --></p>

<p>and the change in the pair <!-- 1f7d3da922442bec0425d6e3e395d701.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="(a_{ij},a_{ji})" display="inline"><mrow><mo stretchy="false">(</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>⁢</mo><mi>j</mi></mrow></msub><mo>,</mo><msub><mi>a</mi><mrow><mi>j</mi><mo>⁢</mo><mi>i</mi></mrow></msub><mo stretchy="false">)</mo></mrow></math></span> is
<fieldset class="ww-messages"><legend>&lt;ww-messages-legend: &gt;</legend><p class='error'>Error: Project file not found: Standalone?6254414d5b6c6a5ac03369dad0f961bc.tex-inline › 6254414d5b6c6a5ac03369dad0f961bc.tex-inline.latexml.html</p>
</fieldset>
<!-- 6254414d5b6c6a5ac03369dad0f961bc.tex-inline.latexml.html --></p>

<p>Q: how does this <!-- 811d6a6518e8b42241ce8a502c121e73.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="D_{(i,j)}" display="inline"><msub><mi>D</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msub></math></span> relate to <!-- 5dbc98dcc983a70728bd082d1a47546e.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="S" display="inline"><mi>S</mi></math></span>?  Is there a meaningful <!-- fd0cab2ec9d92f6067d532eb1d8097a8.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="S_{(i,j)}" display="inline"><msub><mi>S</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msub></math></span>?</p>

<p>We also define</p>

<p><!-- a4d6eff9f7e6536cd11bb4c0b3702c1b.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="S_{(i,j)}=\begin{pmatrix}\hat{X}_{j}\\&#10;\hat{X}_{i}\end{pmatrix}" display="inline"><mrow><msub><mi>S</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msub><mo>=</mo><mrow><mo>(</mo><mtable displaystyle="true"><mtr><mtd columnalign="center"><msub><mover accent="true"><mi>X</mi><mo stretchy="false">^</mo></mover><mi>j</mi></msub></mtd></mtr><mtr><mtd columnalign="center"><msub><mover accent="true"><mi>X</mi><mo stretchy="false">^</mo></mover><mi>i</mi></msub></mtd></mtr></mtable><mo>)</mo></mrow></mrow></math></span> (???),</p>

<p>which is the two entries of <!-- d1c764f9707a8c125ff4c168e6bbb919.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="S(\mathbf{A}_{i})" display="inline"><mrow><mi>S</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>𝐀</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></mrow></math></span> and <!-- 8f38b00e6b829ae84a03e5acc8d62c76.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="S(\mathbf{A}_{j})" display="inline"><mrow><mi>S</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>𝐀</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow></mrow></math></span>,
respectively, corresponding to the entries of <!-- 811d6a6518e8b42241ce8a502c121e73.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="D_{(i,j)}" display="inline"><msub><mi>D</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msub></math></span>, since the
fuller direct effect vectors <!-- a1384aa3ea4e1d4ca4707ed950caee26.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="D_{i}" display="inline"><msub><mi>D</mi><mi>i</mi></msub></math></span>, <!-- 5b58cc0cefa1115cdeb54f391b25591d.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="D_{j}" display="inline"><msub><mi>D</mi><mi>j</mi></msub></math></span> are considered to be <!-- 804f14414dab2297b600211a82c39fa8.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="S_{i}" display="inline"><msub><mi>S</mi><mi>i</mi></msub></math></span>
and <!-- 04c8fd52917642ff9ec6b7e1ad2b711b.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="S_{j}" display="inline"><msub><mi>S</mi><mi>j</mi></msub></math></span> filtered through the biases of available variation; so
<!-- fd0cab2ec9d92f6067d532eb1d8097a8.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="S_{(i,j)}" display="inline"><msub><mi>S</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msub></math></span> may be considered an unconstrained version of <!-- 811d6a6518e8b42241ce8a502c121e73.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="D_{(i,j)}" display="inline"><msub><mi>D</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msub></math></span>.</p>

<p>Consequently we think the <!-- f623e75af30e62bbd73d6df5b50bb7b5.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="D" display="inline"><mi>D</mi></math></span> entries are biased toward positive, while the <!-- dd7536794b63bf90eccfd37f9b147d7f.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="I" display="inline"><mi>I</mi></math></span> entries
are not.  Note that the <!-- f623e75af30e62bbd73d6df5b50bb7b5.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="D" display="inline"><mi>D</mi></math></span> vector is <em>not</em> necessarily positive; it’s only
true that each entry <!-- f67fe603a9f52418310306c2194303d5.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="D_{ij}" display="inline"><msub><mi>D</mi><mrow><mi>i</mi><mo>⁢</mo><mi>j</mi></mrow></msub></math></span> is an element of a vector that’s in a
half-space defined by positive dot product with the positive vector
<!-- b0f6ac7fcbbf1974b7af639977f0d4c7.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="S=\hat{X}" display="inline"><mrow><mi>S</mi><mo>=</mo><mover accent="true"><mi>X</mi><mo stretchy="false">^</mo></mover></mrow></math></span>.  There may be non-positive entries of the <!-- f623e75af30e62bbd73d6df5b50bb7b5.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="D" display="inline"><mi>D</mi></math></span> vector, required
by tradeoffs between the elements of <!-- 702c7ec36a2e8896018332ba9b37e8cb.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="\mathbf{u}_{i}" display="inline"><msub><mi>𝐮</mi><mi>i</mi></msub></math></span> (or by the form of
<!-- 23e72600d3e06c2bb5004d09ad59452c.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="a()" display="inline"><mrow><mi>a</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mo stretchy="false">)</mo></mrow></mrow></math></span>??).</p>

<p>We are plotting</p>

<ul>
  <li>the vectors <!-- fd0cab2ec9d92f6067d532eb1d8097a8.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="S_{(i,j)}" display="inline"><msub><mi>S</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msub></math></span> (red), <!-- 811d6a6518e8b42241ce8a502c121e73.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="D_{(i,j)}" display="inline"><msub><mi>D</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msub></math></span> (green), <!-- 0b65bdc592f4bef0de5c56782a84de87.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="I_{(i,j)}" display="inline"><msub><mi>I</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msub></math></span>
(purple), and <!-- 6a79bf421dede39021b0322f7bd223a6.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="d/dt(a_{ij},a_{ji})" display="inline"><mrow><mrow><mi>d</mi><mo>/</mo><mi>d</mi></mrow><mo>⁢</mo><mi>t</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>⁢</mo><mi>j</mi></mrow></msub><mo>,</mo><msub><mi>a</mi><mrow><mi>j</mi><mo>⁢</mo><mi>i</mi></mrow></msub><mo stretchy="false">)</mo></mrow></mrow></math></span> (blue) at representative points</li>
  <li>the trajectory of <!-- 1f7d3da922442bec0425d6e3e395d701.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="(a_{ij},a_{ji})" display="inline"><mrow><mo stretchy="false">(</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>⁢</mo><mi>j</mi></mrow></msub><mo>,</mo><msub><mi>a</mi><mrow><mi>j</mi><mo>⁢</mo><mi>i</mi></mrow></msub><mo stretchy="false">)</mo></mrow></math></span></li>
</ul>

<p>for all pairs <!-- 5270ae675fac24f97e172dcd9b18fa92.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="(i,j)" display="inline"><mrow><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></math></span>, or at least the half of them sorted with <!-- f1f27e9c5f7572e13a24c7671e1f74be.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="i\leq j" display="inline"><mrow><mi>i</mi><mo>≤</mo><mi>j</mi></mrow></math></span>.</p>

<p>Q: how to display the change in <!-- 34c1d173d638ceb8fb5bec184c055549.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="k_{i}" display="inline"><msub><mi>k</mi><mi>i</mi></msub></math></span>?  <!-- f2a4ab9df3dc2b7d96912b002ad5f3e1.tex-math.latexml.html --><span class="latexml"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="(k_{i},a_{ii})" display="inline"><mrow><mo stretchy="false">(</mo><msub><mi>k</mi><mi>i</mi></msub><mo>,</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>⁢</mo><mi>i</mi></mrow></msub><mo stretchy="false">)</mo></mrow></math></span> or something?</p>

<h2 id="code">Code</h2>

<p>Here is Sage code that works with the SageDynamics code to analyze the
dynamics of Lotka-Volterra coefficients.</p>

<p><!-- lotkavolterra.py.step --><fieldset class="ww-project-file-source ww-collapsible"><legend><span>lotkavolterra.py.step</span></legend><div class="ww-collapsible-content"><pre>from sage.all import *
 
from dynamicalsystems import *

from sage.symbolic.relation import solve
#from sage.symbolic.function_factory import function

class GeneralizedLotkaVolterraModel(PopulationDynamicsSystem):
    &quot;&quot;&quot;The GLV model is dX_i/dt = (r_i + sum_j a_i_j X_j) X_i&quot;&quot;&quot;
    def __init__(self, x_indices = [], X = indexer('X'), r = indexer('r'),
      a = indexer_2d('a'),
      bindings = Bindings()):
        self._indexers = {'r': r, 'a': a, 'X': X}
        super(GeneralizedLotkaVolterraModel,self).__init__(
            [ ], x_indices, X, bindings=bindings )
    def flow(self):
        return self.make_flow(**self._indexers)
    def make_flow(self, X, r, a):
        return dict( (X[i],
          X[i]*(r[i] + sum( a[i][j]*X[j] for j in self._population_indices )))
          for i in self._population_indices)
    def interior_equilibrium_bindings( self, phenotype_bindings=Bindings() ):
	eq = self.bind( phenotype_bindings ).interior_equilibria()[0]
	eb = Bindings( { vhat:eq[vhat] for vhat in self.equilibrium_vars() } )
	#print 'equilibrium bindings:', eb
	return eb

class LotkaVolterraException(Exception):
    def __init__(self, message):
	self.value = message
    def __str__(self):
	return repr(self.value)

def get_coeff( expr, vars, power ):
    for c, p in expr.coefficients( vars ):
        if p == power:
	    return c

class DerivedLotkaVolterraModel( GeneralizedLotkaVolterraModel ):
    &quot;&quot;&quot;This is a LotkaVolterraModel made by decomposing the dynamics of
    some other population dynamics model into linear and quadratic terms.
    It has the attributes of a GeneralizedLotkaVolterraModel, plus some
    additional information about the original model.&quot;&quot;&quot;
    def __init__(self, model, r_name='r', a_name='a', r_indexer=None, a_indexer=None ):
	self._original_model = model
	self._a_name = a_name
	self._r_name = r_name
	if a_indexer is None: a_indexer = indexer_2d(a_name)
	if r_indexer is None: r_indexer = indexer_2d(r_name)
	self._a_indexer = a_indexer
	self._r_indexer = r_indexer
	self.calculate_lv()
        super(DerivedLotkaVolterraModel,self).__init__(
            model._population_indices,
	    X = model._population_indexer,
            r = r_indexer,
            a = a_indexer
	)
    def calculate_lv(self):
	model = self._original_model
        x_indexer = model._population_indexer
        aij_dict = {}
        vars = {v:1 for v in model._vars}
        for i in model._population_indices:
            xi = x_indexer[i]
	    lvi = model._flow[xi].expand()
            print 'Inferring LV coefficients from', xi, 'equation:', lvi
	    xic = get_coeff( lvi, xi, 1 )
	    if xic is None: xic = 0
	    ri = xic
	    aij = get_coeff( lvi, xi, 2 )
	    if aij is None: aij = 0
	    aij_dict[self._a_indexer[i][i]] = aij
            lvi -= aij * xi**2
	    for j in model._population_indices:
	        if j != i:
                    xj = x_indexer[j]
		    ri = get_coeff( ri, xj, 0 )
		    if ri is None: ri = 0
		    aij = get_coeff( xic, xj, 1 )
		    if aij is None: aij = 0
		    aij_dict[self._a_indexer[i][j]] = aij
                    print self._a_indexer[i][j], ':', aij
                    lvi -= aij * xi * xj
            print self._r_indexer[i], ':', ri
	    aij_dict[self._r_indexer[i]] = ri
            lvi -= ri * xi
            if lvi != 0:
                raise LotkaVolterraException( &quot;Population dynamics has excess terms in &quot; + str(i) + &quot;'th component: &quot; + str(lvi) )
            del vars[xi]
        if len(vars) &gt; 0:
            raise LotkaVolterraException( &quot;Population dynamics has extra variables: &quot; + ', '.join(vars.keys()) )
	print 'aij_dict:',aij_dict; sys.stdout.flush()
	self._A_bindings = Bindings( aij_dict ) 
    def set_population_indices(self, npi):
	super(DerivedLotkaVolterraModel, self).set_population_indices(npi)
	self.calculate_lv()
    def mutate(self, resident_index):
	mutant = self._original_model.mutate(resident_index)
	self.set_population_indices( self._original_model._population_indices )
	return mutant

class inner_curry(indexer):
    def __init__(self, ixr, j):
	self._f = ixr
	self. _j = j
    def __getitem__(self, i):
	return self._f[i][self._j]

class backward_curry_indexer_2d( indexer ):
    def __init__(self, ixr):
	self._f = ixr
    def __getitem__(self, j):
	# return a thing that maps i --&gt; ixr[i][j]
	return inner_curry(self._f, j)

class LotkaVolterraAdaptiveDynamics( object ):
    '''Not an AdaptiveDynamicsModel class, but a helper that works with one.'''
    def __init__( self, ad, lv_model=None, r_name='r', a_name='a', r_name_indexer=None, a_name_indexer=None ):
        self._adaptivedynamics = ad

	print 'ad bindings:', self._adaptivedynamics._bindings
	print 'model bindings:', self._adaptivedynamics._popdyn_model._bindings
	print '_early_bindings:', self._adaptivedynamics._early_bindings
	print '_late_bindings:', self._adaptivedynamics._late_bindings

	if a_name_indexer is None: a_name_indexer = indexer_2d(a_name)
	if r_name_indexer is None: r_name_indexer = indexer(r_name)
	self._a_name_indexer = a_name_indexer
	self._r_name_indexer = r_name_indexer

	# make LV model here
	print 'make LV model'
	self._lv_model = DerivedLotkaVolterraModel( ad._popdyn_model, r_indexer=r_name_indexer, a_indexer=a_name_indexer )

	print '_A_bindings:', self._lv_model._A_bindings

	# for now, this only supports AD with a single phenotype variable
	u_indexers = self._adaptivedynamics._phenotype_indexers

	if False:
	    # sanity check the a values' functional form
	    # using extended system, in case it's only 1-d otherwise
	    extended_system = deepcopy( ad._popdyn_model )
	    # TODO: mutate all populations, not just the first one
	    mutant_index = extended_system.mutate( extended_system._population_indices[0] )
	    extended_lv_model = DerivedLotkaVolterraModel( extended_system, r_name=r_name, a_name=a_name )
	    a_to_u_bindings = self._adaptivedynamics._bindings + self._adaptivedynamics._late_bindings + extended_lv_model._A_bindings
	    print 'a_to_u_bindings:', a_to_u_bindings
            u0s = column_vector( [ u_indexer[0] for u_indexer in u_indexers ] )
            uqis = column_vector( [ u_indexer[mutant_index] for u_indexer in u_indexers ] )
            a_func = a_to_u_bindings( extended_lv_model._indexers['a'][0][mutant_index] ).function( *(list(u0s) + list(uqis)) )
	    print 'a_func:', a_func
	    r_func = a_to_u_bindings( extended_lv_model._indexers['r'][0] ).function( *u0s )
	    print 'r_func:', r_func
	    for i in ad._popdyn_model._population_indices:
                uis = column_vector( u[i] for u in u_indexers )
	        for j in ad._popdyn_model._population_indices:
                    ujs = column_vector( u[j] for u in u_indexers )
	            if a_to_u_bindings( extended_lv_model._indexers['a'][i][j] ) != a_func( *(list(uis)+list(ujs)) ):
		        raise LotkaVolterraException(
			    'Model does not have consistent form a(u_i,u_j): ' +
			    str( a_to_u_bindings( extended_lv_model._indexers['a'][i][j] ) ) +
			    ' does not have the form of ' +
                            'a(%s, %s) = ' % (''.join(str(u[i]) for u in u_indexers), ''.join(str(u[j]) for u in u_indexers)) +
			    str( a_func( *(list(uis) + list(ujs)) ) ) )
		    if a_to_u_bindings( extended_lv_model._indexers['r'][i] ) != r_func( *uis ):
		        raise LotkaVolterraException(
			    'Model does not have consistent form r(u_i): ' +
			    str( a_to_u_bindings( extended_lv_model._indexers['r'][i] ) ) +
			    ' does not have the form of ' +
			    str( r_func( *uis ) ) )
	            for k in ad._popdyn_model._population_indices:
		        if len( extended_lv_model._A_bindings( extended_lv_model._indexers['a'][i][j] ).coefficients( extended_lv_model._population_indexer[k] ) ) &gt; 1:
		            raise LotkaVolterraException( 'Model has super-quadratic terms in population variables' )


	print 'make LV adaptive dynamics'
	print 'population vars', self._lv_model.population_vars()
	print 'population vars', self._lv_model._original_model.population_vars()
        formal_equilibrium = Bindings( { v : hat(v) for v in self._lv_model.population_vars() } )
	self._lv_adap = AdaptiveDynamicsModel(
	    self._lv_model,
	    [ self._lv_model._indexers['r'] ] + [ backward_curry_indexer_2d(self._lv_model._indexers['a'])[j] for j in self._lv_model._population_indices ],
            equilibrium = formal_equilibrium )
	# todo: what to do with multiple phenotype indexers?
	print 'make LV evolution bindings'
	#ui = self._adaptivedynamics._phenotype_indexers[0]
        us = self._adaptivedynamics._phenotype_indexers
	# _A_to_function_bindings expands the LV equations
	# into functions of u_i, e.g. from a_i_j to a(u_i,u_j)
	# very necessary so that partial derivatives can be taken
	from sage.symbolic.function_factory import function
	_A_to_function_dict = [
	  ( a_name_indexer[i][j], 
	    self._lv_model._A_bindings( function( str( a_name_indexer[i][j] ) )( *([u[i] for u in us] + [u[j] for u in us] ) ) ) )
	  for i in self._lv_model._population_indices
	  for j in self._lv_model._population_indices ] + [
	  ( r_name_indexer[i],
	    self._lv_model._A_bindings( function( str( r_name_indexer[i] ) )( *(u[i] for u in us) ) ) )
	  for i in self._lv_model._population_indices ]
	#print '_A_to_function_dict:', _A_to_function_dict
	self._A_to_function_bindings = Bindings( dict( _A_to_function_dict ) )

	A_late_bindings = self._lv_model._A_bindings + self._adaptivedynamics._bindings + self._adaptivedynamics._late_bindings
	_A_function_expansion_dict = dict( [
	    ( a_name_indexer[i][j],
		A_late_bindings( a_name_indexer[i][j] )
		    .function( *([ u_indexer[i] for u_indexer in u_indexers ] + [ u_indexer[j] for u_indexer in u_indexers ]) ) )
		for i in self._lv_model._population_indices
		for j in self._lv_model._population_indices
	] + [
	    ( r_name_indexer[i],
		A_late_bindings( r_name_indexer[i] )
		    .function( *([ u_indexer[i] for u_indexer in u_indexers ]) ) )
		for i in self._lv_model._population_indices
	] )
	#print '_A_function_expansion_dict:', _A_function_expansion_dict
	self._A_function_expansion_bindings = Bindings( FunctionBindings(
	    _A_function_expansion_dict ) )
	#print '_A_function_expansion_bindings:', self._A_function_expansion_bindings
	# _phenotypes_to_fn_bindings: changes u_i to u_i(t)
	# is used in all the below methods, so that du_i(t)/dt works
	self._phenotypes_to_fn_bindings = Bindings( dict(
	    ( u[i], function( str(u[i]), self._adaptivedynamics._time_variable, latex_name=latex(u[i]) ) )
	    for i in self._lv_model._population_indices
	    for u in self._adaptivedynamics._phenotype_indexers ) )
	# _phenotypes_from_fn_bindings: the inverse, change u_i(t) to u_i
	self._phenotypes_from_fn_bindings = Bindings(
	    { v:k for k, v in self._phenotypes_to_fn_bindings.items() } )
	#print '_phenotypes_from_fn_bindings:', self._phenotypes_from_fn_bindings
    def bind_in_place( self, *bindings, **args ):
	b = Bindings( *bindings, **args )
	self._adaptivedynamics.bind_in_place( b )
	self._lv_model.bind_in_place( b )
	self._lv_adap.bind_in_place( b )
	self._A_to_function_bindings.bind_in_place( b )
	self._A_function_expansion_bindings.bind_in_place( b )
	self._phenotypes_to_fn_bindings.bind_in_place( b )
	self._phenotypes_from_fn_bindings.bind_in_place( b )
    def A( self, i ):
        '''The 'interaction phenotype' vector of Lotka-Volterra coefficients
        that are affected by selection on population i.  These are r_i and a_ij
        for all j.'''
        # this is a vector, intended to be treated as a column vector.
        return vector(
            [ self._lv_model._indexers['r'][i] ] +
            [ self._lv_model._indexers['a'][i][j] for j in self._lv_model._population_indices ] )
    def S( self, A ):
        '''The selection gradient corresponding to the 'interaction phenotype'
        A.'''
        # This is a vector, intended to be treated as a column vector.
        S = vector( [ self._lv_adap._S[a] for a in A ] )
	#print 'S:', S
	return S
    def d1A( self, i ):
	'''&quot;Direct effect&quot;: derivative of A(u_i) wrt u_i with u_i in the &quot;patient&quot;
        position, as the first argument of a(.,.).'''
        # this is a matrix, with row indices the same as in A and column
        # indices indexing the entries of the u phenotype vector.
        A_ij = self._A_to_function_bindings( self.A(i) )
	uis = column_vector( [ u[i] for u in self._adaptivedynamics._phenotype_indexers ] )
	xx = self._adaptivedynamics.fake_population_index()
	uxs = column_vector( [ u[xx] for u in self._adaptivedynamics._phenotype_indexers ] )
	#print 'hack A_ij: from', A_ij
        A_ij_hacked = A_ij.apply_map( lambda x: x.subs_expr( function( str( self._a_name_indexer[i][i] ) )(*(list(uis)+list(uis))) == function( str( self._a_name_indexer[i][i] ) )(*(list(uis)+list(uxs))) ) )
	#print 'to', A_ij_hacked
	#print 'd1A: derivative of $%s$ wrt $%s$' % (latex(A_ij_hacked), latex(uis))
        d1a = matrix( [ [ aij.derivative( u ) for u in uis ] for aij in A_ij_hacked ] )
	#print 'is $%s$' % latex( d1a )
        d = d1a
        for ux, ui in zip( uxs, uis ):
	    d = d.subs( ux == ui )
	#print '; $%s$' % latex( d )
	d = self._A_function_expansion_bindings( d )
	#print ': $%s$' % latex( d )
	return d
    def direct_effect( self, i ):
        # the component of change in A due to direct selection on population i
        # a vector
	return ( self._phenotypes_to_fn_bindings( self.d1A(i) ) * derivative(
	        self._phenotypes_to_fn_bindings( vector( [ u[i] for u in self._adaptivedynamics._phenotype_indexers ] ) ),
	        self._adaptivedynamics._time_variable
	    ) )
    def d2A_component( self, i, j ):
        '''Component of &quot;Indirect effects&quot; on &quot;patient&quot; u_i, due to &quot;agent&quot; u_j.
        When j is i, this includes only the &quot;agent&quot; role of u_i, which is where
        it appears as the second argument of a().'''
        # this is a matrix, with row indices the same as in A and column
        # indices indexing the entries of the u phenotype vector.
        A_ij = self._A_to_function_bindings( self.A(i) )
	u = self._adaptivedynamics._phenotype_indexers[0]
        if j == i:
	    uis = [ u[i] for u in self._adaptivedynamics._phenotype_indexers ]
	    xx = self._adaptivedynamics.fake_population_index()
	    uxs = [ u[xx] for u in self._adaptivedynamics._phenotype_indexers ]
            A_ij_hacked = A_ij.apply_map( lambda x: x.subs_expr( function( str( self._a_name_indexer[i][i] ) )( *(uis+uis) ) == function( str( self._a_name_indexer[i][i] ) )( *(uis+uxs) ) ) )
            #print A_ij,', with', function( self._lv_model._a_name )( *(uis+uis) ), ' =&gt; ', function( self._lv_model._a_name )( *(uis+uxs) ), ' == ', A_ij_hacked
	    #print 'd2A: derivative of $%s$ wrt $%s$' %(latex(A_ij_hacked), latex(uxs))
            d2A_hacked = matrix( [ [ aij.derivative( uxi ) for uxi in uxs ] for aij in A_ij_hacked ] )
	    #print 'is $%s$' % latex(d2A_hacked)
            d2A = Bindings( { uxi:uii for uxi, uii in zip(uxs, uis) } )( d2A_hacked )
            #print 'on diagonal: $\partial_2 A = %s$\n\n' % latex( d2A )
        else:
	    #print 'd2A: derivative of $%s$ wrt $%s$' %(latex(A_ij), latex(u[j]))
            d2A = matrix( [ [ aij.derivative( u[j] ) for u in self._adaptivedynamics._phenotype_indexers ] for aij in A_ij ] )
	    #print 'is $%s$'% latex( d2A )
            #ltx.write( 'off diagonal: $\partial_2 A = %s$\n\n' % latex( d2A ) )
	return self._A_function_expansion_bindings( d2A )
    def indirect_effect( self, i ):
        # component of the motion of A_i due to selection on all &quot;agents&quot; that
        # act on population i
        # a vector
	components = [ self._phenotypes_to_fn_bindings( self.d2A_component( i, j ) ) * derivative(
	        self._phenotypes_to_fn_bindings( vector( [ u[j] for u in self._adaptivedynamics._phenotype_indexers ] ) ),
	        self._adaptivedynamics._time_variable
	    ) for j in self._lv_model._population_indices ]
	#import operator
	return reduce( operator.add, components )
    def dudt_bindings( self ):
	# TODO: AD class should provide one of these, and
	# use it internally as well
        # TODO: make matrix * column_vector work
	dudts = {
            i:( SR('gamma') * hat( self._lv_model._population_indexer[i] ) *
	        self.d1A(i).transpose() * self.S( self.A(i) ) )
              for i in self._lv_model._population_indices
        }
        #print 'dudts:', dudts
	return Bindings( {
	    derivative(
                self._phenotypes_to_fn_bindings( us[i] ),
                self._adaptivedynamics._time_variable
            ): dudts[i][j]
	      for i in self._lv_model._population_indices
              for j,us in enumerate(self._adaptivedynamics._phenotype_indexers)
        } )
    def dAdt( self, i ):
        # the motion of the 'interaction phenotype' A_i.  This is not computed
        # using the above components, but by using the chain rule with the
        # derivative of the constraint phenotype u_i.
        # A vector.
        Ai = self.A(i)
	Au = self._adaptivedynamics._bindings( self._lv_model._A_bindings( Ai ) )
	#import operator
        dAdus = [ self._phenotypes_to_fn_bindings( diff( Au, u[j] ) ) for u in self._adaptivedynamics._phenotype_indexers for j in self._lv_model._population_indices ]
        dudts = [ diff( self._phenotypes_to_fn_bindings( u[j] ), self._adaptivedynamics._time_variable ) for u in self._adaptivedynamics._phenotype_indexers for j in self._lv_model._population_indices ]
        dAdts = [ vector( dAiduj * dujdt for dAiduj in dAduj ) for dAduj, dujdt in zip( dAdus, dudts ) ]
	d = reduce( operator.add, dAdts )
	#print 'dAdt: diff of Au is $%s$' % latex( d )
        sys.stdout.flush()
	return d
    def A_index( self, j ):
	# help for using the above vectors: e.g. self.A(i)[self.A_index(j)]
	# is the a_ij term.
	try: self._A_index_dict.keys()
	except AttributeError:
	    self._A_index_dict = dict( (v,i) for i,v in enumerate( [0] + self._lv_model._population_indices ) )
	return self._A_index_dict[j]
    def A_pair( self, i, j ):
	return vector( [
	    self.A(i)[self.A_index(j)],
	    self.A(j)[self.A_index(i)]
	] )
    def S_pair( self, i, j ):
	return vector( [
	    self.S( self.A(i) )[self.A_index(j)],
	    self.S( self.A(j) )[self.A_index(i)]
	] )
    def D_pair( self, i, j ):
	return vector( [
	    self.direct_effect( i )[self.A_index(j)],
	    self.direct_effect( j )[self.A_index(i)]
	] )
    def I_pair( self, i, j ):
	return vector( [
	    self.indirect_effect( i )[self.A_index(j)],
	    self.indirect_effect( j )[self.A_index(i)]
	] )
    def dAdt_pair( self, i, j ):
	return vector( [
	    self.dAdt( i )[self.A_index(j)],
	    self.dAdt( j )[self.A_index(i)]
	] )

def plot_aij_with_arrows( evol_trajectory, lvad, filename=None, scale=1, bindings=Bindings(), **options ):
    aap = Graphics()
    for i in lvad._lv_model._population_indices:
        for j in lvad._lv_model._population_indices:
	    aap += evol_trajectory.plot(
	        lvad._lv_model._A_bindings( lvad._lv_model._a_indexer[i][j] ),
	        lvad._lv_model._A_bindings( lvad._lv_model._a_indexer[j][i] ),
	        color='red', **options
	    )
	    # plot 4 arrows per (i,j) point
	    pp0 = evol_trajectory._timeseries[0]
	    aap += plot_single_aij_pair( i, j, pp0, lvad, scale=scale, bindings=bindings, **options )
    aap.axes_labels( [ '$a_{ij}$', '$a_{ji}$' ] )
    if filename is not None:
	if 'figsize' not in options: options['figsize'] = (5,5)
        aap.save( filename, **options )
    return aap

def plot_single_aij_pair( i, j, p, lvad, filename=None, scale=1, bindings=Bindings(), **options ):
    resolve_A_bindings = (
	lvad._A_to_function_bindings +
	lvad._A_function_expansion_bindings +
	lvad.dudt_bindings() +
	lvad._phenotypes_from_fn_bindings
    )
    pp0 = p + bindings + lvad._adaptivedynamics._bindings
    aap = Graphics()
    Aij = (
	pp0( resolve_A_bindings( lvad.A(i)[lvad.A_index(j)] ) ),
	pp0( resolve_A_bindings( lvad.A(j)[lvad.A_index(i)] ) )
    )
    print 'A:', Aij
    S = (
	pp0( resolve_A_bindings( lvad.S( lvad.A(i) )[lvad.A_index(j)] ) ),
	pp0( resolve_A_bindings( lvad.S( lvad.A(j) )[lvad.A_index(i)] ) )
    )
    print 'S:', S
    if S[0] != 0 or S[1] != 0:
	aap += arrow( Aij, ( a+scale*s for a,s in zip(Aij, S) ), color='red' )
    D = (
	resolve_A_bindings( lvad.direct_effect( i )[lvad.A_index(j)] ),
	resolve_A_bindings( lvad.direct_effect( j )[lvad.A_index(i)] )
    )
    print 'D:', D
    D = (
	pp0( D[0] ),
	pp0( D[1] )
    )
    print 'D:', D
    if D[0] != 0 or D[1] != 0:
	aap += arrow( Aij, ( a+scale*d for a,d in zip(Aij, D) ), color='green' )
    I = (
	resolve_A_bindings( lvad.indirect_effect( i )[lvad.A_index(j)] ),
	resolve_A_bindings( lvad.indirect_effect( j )[lvad.A_index(i)] )
    )
    print 'I:', I
    I = (
	pp0( I[0] ),
	pp0( I[1] )
    )
    print 'I:', I
    if I[0] != 0 or I[1] != 0:
	DI = ( D[0] + I[0], D[1] + I[1] )
	aap += arrow(
	    ( a+scale*d for a,d in zip(Aij, D) ),
	    ( a+scale*i for a,i in zip(Aij, DI) ),
	    color='purple' )
    d = (
	pp0( resolve_A_bindings( lvad.dAdt( i )[lvad.A_index(j)] ) ),
	pp0( resolve_A_bindings( lvad.dAdt( j )[lvad.A_index(i)] ) )
    )
    print 'dAdt:', d
    if d[0] != 0 or d[1] != 0:
	aap += arrow( Aij, ( a+scale*d for a,d in zip(Aij, d) ), color='blue' )
    ## curve parametrized by varying u_i only
    ## todo: anything, when i==j?
    ux = SR.symbol()
    for u_var in (ui[i] for ui in lvad._adaptivedynamics._phenotype_indexers):
	if lvad._adaptivedynamics._flow[u_var] != 0:
	    px = Bindings( { u_var: ux } ) + pp0
	    print px
	    A_curve = (
		px( resolve_A_bindings( lvad.A(i)[lvad.A_index(j)] ) ),
		px( resolve_A_bindings( lvad.A(j)[lvad.A_index(i)] ) )
	    )
	    print 'curve:', A_curve
	    aap += parametric_plot( A_curve, (ux,pp0(u_var)-1,pp0(u_var)+1), color='green' )
    aap.axes_labels( [ '$a_{ij}$', '$a_{ji}$' ] )
    if filename is not None:
	if 'figsize' not in options: options['figsize'] = (5,5)
        aap.save( filename, **options )
    return aap
</pre></div></fieldset></p>

<p>Here is a makefile that is used by all the code on the various pages in this project.</p>

<p><!-- sage-inline.mk --><fieldset class="ww-project-file-source ww-collapsible"><legend><span>sage-inline.mk</span></legend><div class="ww-collapsible-content"><pre>%.sage.step : %.sage-inline <a href='/adaptive-dynamics-research/wmd_files/Selection_Gradients/sage-inline.mk'>sage-inline.mk</a>
	echo '# produces: $*.sage.out.tex' > $@
	echo 'from dynamicalsystems import latex_output' >> $@
	echo 'ltx = latex_output( "$*.sage.out.tex" )' >> $@
	cat $< >> $@
	echo 'ltx.close()' >> $@

WW_SI_SOURCE_FILES = $(filter %.sage-inline,$(WW_THIS_PROJECT_SOURCE_FILES))
WW_SI_MK_FILES = $(patsubst %.sage-inline,%.sage.mk,$(WW_SI_SOURCE_FILES))
$(info <a href='/adaptive-dynamics-research/wmd_files/Selection_Gradients/Including'>Including</a> <a href='/adaptive-dynamics-research/wmd_files/Selection_Gradients/.mk'>.mk</a> <a href='/adaptive-dynamics-research/wmd_files/Selection_Gradients/files'>files</a> <a href='/adaptive-dynamics-research/wmd_files/Selection_Gradients/from'>from</a> <a href='/adaptive-dynamics-research/wmd_files/Selection_Gradients/.sage-inline'>.sage-inline</a> <a href='/adaptive-dynamics-research/wmd_files/Selection_Gradients/files'>files</a>: $(WW_SI_MK_FILES))
<a href='/adaptive-dynamics-research/wmd_files/Selection_Gradients/include'>include</a> $(WW_SI_MK_FILES)
</pre></div></fieldset></p>

<p>Here is some general-purpose Sage utility code, that may ultimately end
up somewhere more central.</p>

<p></p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <h2 class="footer-heading">Lee Worden</h2>

    <div class="footer-col-1 column">
      <ul>
        <li><a href="mailto:worden.lee@gmail.com">worden.lee@gmail.com</a></li>
      </ul>
    </div>

    <div class="footer-col-2 column">
      <ul>
        <li>
          <a href="https://github.com/worden-lee">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <span class="username">worden-lee</span>
          </a>
        </li>
        <li>
          <a href="https://twitter.com/leeworden">
            <span class="icon twitter">
              <svg version="1.1" class="twitter-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
                c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
                c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
                C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
                c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
                c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
              </svg>
            </span>
            <span class="username">leeworden</span>
          </a>
        </li>
      </ul>
    </div>

    <div class="footer-col-3 column">
	    <p class="text"><!-- Any additional text --></p>
    </div>

  </div>

</footer>


    </body>
</html>
